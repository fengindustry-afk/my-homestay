# Supabase Setup for Serenity Homestay

Follow these steps to set up your Supabase database and connect it to your website.

## 1. Create Tables
Copy and paste the following SQL into the [Supabase SQL Editor](https://app.supabase.com/) and click **Run**.

```sql
-- 1. Create 'rooms' table
create table public.rooms (
  id bigint generated by default as identity primary key,
  title text not null,
  type text not null,
  location text not null,
  price numeric not null,
  badge text,
  beds integer not null,
  baths integer not null,
  guests integer not null,
  image text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 2. Create 'bookings' table
create table public.bookings (
  id bigint generated by default as identity primary key,
  room_id bigint references public.rooms(id),
  guest_name text not null,
  guest_email text not null,
  check_in date not null,
  check_out date not null,
  total_price numeric not null,
  payment_status text default 'pending', -- 'pending', 'paid', 'failed'
  billplz_id text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 3. Create 'testimonials' table
create table public.testimonials (
  id bigint generated by default as identity primary key,
  name text not null,
  role text not null,
  avatar text,
  content text not null,
  stars integer check (stars >= 1 and stars <= 5),
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 4. Enable Row Level Security (RLS)
alter table public.rooms enable row level security;
alter table public.bookings enable row level security;
alter table public.testimonials enable row level security;

-- 5. Create Policies (Allow public to view rooms and testimonials)
create policy "Allow public read access to rooms" on public.rooms for select using (true);
create policy "Allow public read access to testimonials" on public.testimonials for select using (true);
create policy "Allow public insert to bookings" on public.bookings for insert with check (true);

-- 5b. Allow command centre to create, update, and delete rooms (dev / anon key)
create policy "Allow public insert rooms" on public.rooms for insert with check (true);
create policy "Allow public update rooms" on public.rooms for update using (true) with check (true);
create policy "Allow public delete rooms" on public.rooms for delete using (true);

-- 6. Insert Initial Demo Data (Rooms)
insert into public.rooms (title, type, location, price, badge, beds, baths, guests, image)
values 
('The Serene Suite', 'Deluxe Suite', 'Block A, Level 3', 280, 'Popular', 2, 1, 4, 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=800&q=80'),
('Garden View Room', 'Standard Room', 'Block B, Level 1', 150, null, 1, 1, 2, 'https://images.unsplash.com/photo-1611892440504-42a792e24d32?w=800&q=80'),
('Family Paradise', 'Family Room', 'Block A, Level 2', 350, 'Best Value', 3, 2, 6, 'https://images.unsplash.com/photo-1590490360182-c33d57733427?w=800&q=80'),
('Modern Studio Loft', 'Studio', 'Block C, Level 4', 180, null, 1, 1, 2, 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&q=80'),
('Royal Penthouse', 'Penthouse', 'Block A, Level 8', 550, 'Exclusive', 3, 2, 6, 'https://images.unsplash.com/photo-1618773928121-c32242e63f39?w=800&q=80'),
('Cozy Retreat', 'Standard Room', 'Block B, Level 2', 120, null, 1, 1, 2, 'https://images.unsplash.com/photo-1595576508898-0ad5c879a061?w=800&q=80');

-- 7. Insert Initial Demo Data (Testimonials)
insert into public.testimonials (name, role, avatar, content, stars)
values 
('Sarah Chen', 'Family Traveler', 'https://i.pravatar.cc/100?img=1', 'Absolutely stunning property! The rooms were immaculate and the staff went above and beyond.', 5),
('Ahmad Razak', 'Business Trip', 'https://i.pravatar.cc/100?img=3', 'Perfect for my business stay. Fast Wi-Fi, quiet environment, and everything I needed was nearby.', 5),
('Emily Wong', 'Couple Retreat', 'https://i.pravatar.cc/100?img=5', 'The most romantic getaway! The pool view was breathtaking and the breakfast was delicious.', 5);

-- 8. Optional: site_settings table for command centre content editing
create table if not exists public.site_settings (
  key text primary key,
  value text not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

alter table public.site_settings enable row level security;

create policy "Allow public read site_settings" on public.site_settings
  for select using (true);

-- For development you can temporarily allow upsert from the public anon key:
create policy "Allow public upsert site_settings" on public.site_settings
  for all using (true) with check (true);

-- 8b. Optional: gallery photos for each room (used by Main Command Centre uploads)
create table if not exists public.room_photos (
  id bigint generated by default as identity primary key,
  room_id bigint not null references public.rooms(id) on delete cascade,
  url text not null,
  storage_path text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

alter table public.room_photos enable row level security;

create policy "Allow public read room_photos" on public.room_photos
  for select using (true);

-- Development-only (remove/tighten for production):
create policy "Allow public insert room_photos (dev)" on public.room_photos
  for insert with check (true);
create policy "Allow public delete room_photos (dev)" on public.room_photos
  for delete using (true);

-- 8c. Supabase Storage (for room photos)
-- Run these to create the bucket and allow uploads:

-- Create the bucket
insert into storage.buckets (id, name, public)
values ('room-photos', 'room-photos', true)
on conflict (id) do nothing;

-- Set up policies
create policy "Public read room-photos" on storage.objects
  for select using (bucket_id = 'room-photos');
create policy "Public insert room-photos (dev)" on storage.objects
  for insert with check (bucket_id = 'room-photos');
create policy "Public delete room-photos (dev)" on storage.objects
  for delete using (bucket_id = 'room-photos');

-- 9. Optional: relax bookings policies during development so the command centre can read/update
create policy "Allow public read bookings (dev)" on public.bookings
  for select using (true);

create policy "Allow public update bookings (dev)" on public.bookings
  for update using (true) with check (true);

create policy "Allow public delete bookings (dev)" on public.bookings
  for delete using (true);
```

## 2. Connect to Next.js
1. Go to your Supabase Project Settings > **API**.
2. Copy the `Project URL` and `anon public key`.
3. Paste them into your `.env.local` file:
   ```env
   NEXT_PUBLIC_SUPABASE_URL=your_project_url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
   ```

## 3. Usage in Code
You can now replace your static arrays with database calls. Example:

```typescript
import { supabase } from '@/lib/supabaseClient';

// Example fetching rooms
const { data: rooms, error } = await supabase.from('rooms').select('*');
```
